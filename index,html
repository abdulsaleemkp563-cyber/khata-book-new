<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Khata Book Pro V35 Max</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.autotable.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root { --app-height: 100vh; }
body {
font-family: 'Inter', -apple-system, sans-serif;
height: var(--app-height);
overflow: hidden;
transition: background 0.3s, color 0.3s;
}

/* Dark Theme (Default) */
body.dark-mode { background-color: #020617; color: #f8fafc; }
.dark-mode .app-container { background: #0f172a; }
.dark-mode .card { background: #1e293b; border-color: #334155; }
.dark-mode .text-main { color: #f1f5f9; }
.dark-mode .text-sub { color: #94a3b8; }
.dark-mode .modal-bg { background: #0f172a; border-top-color: #334155; }

/* Light Theme */
body.light-mode { background-color: #f1f5f9; color: #0f172a; }
.light-mode .app-container { background: #ffffff; }
.light-mode .card { background: #f8fafc; border-color: #e2e8f0; }
.light-mode .text-main { color: #1e293b; }
.light-mode .text-sub { color: #64748b; }
.light-mode .modal-bg { background: #ffffff; border-top-color: #e2e8f0; }
.light-mode .khata-table th { background: #f1f5f9; color: #475569; }

.app-container {
height: 100%;
display: flex;
flex-direction: column;
width: 100%;
max-width: 500px;
margin: 0 auto;
position: relative;
box-shadow: 0 0 50px rgba(0,0,0,0.3);
}
.scroll-area { flex: 1; overflow-y: auto; padding-bottom: 140px; }

.premium-header {
background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
padding: 20px;
border-bottom-left-radius: 35px;
border-bottom-right-radius: 35px;
}

.khata-table { width: 100%; border-collapse: separate; border-spacing: 0; }
.khata-table th { padding: 15px; text-align: center; font-size: 11px; font-weight: 900; letter-spacing: 0.05em; }
.khata-table td { padding: 18px 10px; text-align: center; border-bottom: 1px solid rgba(128,128,128,0.1); font-size: 14px; font-weight: 600; }

.amt-get { color: #10b981; }
.amt-give { color: #f43f5e; }

.sticky-footer {
position: absolute; bottom: 0; left: 0; right: 0;
padding: 20px 24px calc(24px + env(safe-area-inset-bottom));
border-top: 1px solid rgba(128,128,128,0.1); z-index: 100;
backdrop-filter: blur(10px);
}

.active-scale:active { transform: scale(0.94); transition: 0.1s; }
.modal-up { animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

/* Report Preview Styles */
#reportPreviewContent table { width: 100%; border-collapse: collapse; margin-top: 10px; }
#reportPreviewContent th, #reportPreviewContent td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
#reportPreviewContent th { background-color: #f2f2f2; color: #333; }
.light-mode #reportPreviewContent td { color: #333; }
.dark-mode #reportPreviewContent td { color: #eee; }
</style>
</head>
<body class="dark-mode">

<div class="app-container">
<!-- Header -->
<header class="bg-[#3730a3] p-5 flex justify-between items-center shrink-0">
<div class="flex items-center gap-4">
<button id="backBtn" class="hidden w-10 h-10 flex items-center justify-center rounded-full bg-white/10 active-scale" onclick="goHome()">
<i class="fa-solid fa-arrow-left text-white"></i>
</button>
<div>
<h1 id="headerTitle" class="text-lg font-black tracking-tight text-white uppercase leading-none">KHATA MAX</h1>
<p id="subHeader" class="text-[9px] text-indigo-300 font-bold uppercase tracking-[0.2em] mt-1">V35 Professional</p>
</div>
</div>
<div class="flex gap-2">
<button onclick="toggleDarkMode()" class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center active-scale" title="Toggle Theme">
<i id="themeIcon" class="fa-solid fa-moon text-indigo-200"></i>
</button>
<button id="searchToggle" onclick="toggleSearch()" class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center active-scale">
<i class="fa-solid fa-magnifying-glass text-indigo-200"></i>
</button>
<button onclick="openSettings()" class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center active-scale">
<i class="fa-solid fa-gear text-indigo-200"></i>
</button>
</div>
</header>

<!-- Search Bar -->
<div id="searchContainer" class="hidden px-5 py-4 bg-indigo-900/10 border-b border-indigo-500/20">
<input type="text" id="searchInput" oninput="filterList()" placeholder="തിരയുക (Search)..." class="w-full p-4 rounded-2xl bg-black/20 border border-indigo-500/30 outline-none font-bold text-main">
</div>

<main id="appContent" class="scroll-area"></main>

<!-- Footer -->
<footer class="sticky-footer" id="mainFooter">
<div id="homeFooter">
<button onclick="openCustomerModal()" class="w-full bg-indigo-600 text-white py-5 rounded-3xl font-black active-scale shadow-xl flex items-center justify-center gap-2 text-lg">
<i class="fa-solid fa-plus-circle"></i> പുതിയ കസ്റ്റമർ
</button>
</div>
<div id="detailActions" class="hidden flex gap-4">
<button onclick="openTransModal('GAVE')" class="flex-1 bg-rose-600 text-white py-5 rounded-3xl font-black active-scale shadow-lg text-lg">നൽകി (GIVE)</button>
<button onclick="openTransModal('GOT')" class="flex-1 bg-emerald-600 text-white py-5 rounded-3xl font-black active-scale shadow-lg text-lg">ലഭിച്ചു (GET)</button>
</div>
</footer>
</div>

<!-- Modals -->
<div id="modalOverlay" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md z-[200] flex items-end justify-center">

<!-- Report Preview Modal -->
<div id="reportModal" class="hidden modal-bg w-full max-w-md p-6 rounded-t-[40px] modal-up border-t">
<h2 class="text-xl font-black mb-4 text-indigo-500 uppercase text-center">റിപ്പോർട്ട് പ്രിവ്യൂ</h2>

<div class="space-y-3 mb-6">
<div class="flex gap-2">
<div class="flex-1">
<label class="text-[10px] font-black text-sub uppercase ml-2">Start Date</label>
<input type="date" id="reportStart" class="w-full bg-black/10 p-3 rounded-xl border border-slate-700 font-bold text-main">
</div>
<div class="flex-1">
<label class="text-[10px] font-black text-sub uppercase ml-2">End Date</label>
<input type="date" id="reportEnd" class="w-full bg-black/10 p-3 rounded-xl border border-slate-700 font-bold text-main">
</div>
</div>
<button onclick="updatePreview()" class="w-full bg-indigo-500/10 text-indigo-400 py-2 rounded-xl font-bold text-sm">Update Preview</button>
</div>

<div id="reportPreviewArea" class="max-h-[300px] overflow-y-auto bg-black/5 p-4 rounded-2xl border border-dashed border-slate-700 mb-6">
<div id="reportPreviewContent">
<p class="text-center text-sub py-10 font-bold">തിയതി നൽകി അപ്‌ഡേറ്റ് ചെയ്യുക</p>
</div>
</div>

<div class="flex gap-3">
<button onclick="closeModal()" class="flex-1 py-4 font-bold text-sub bg-slate-500/10 rounded-2xl">മടങ്ങുക</button>
<button onclick="downloadPDF()" id="pdfBtn" class="flex-[2] bg-indigo-600 text-white py-4 rounded-2xl font-black shadow-lg">PRINT / SAVE PDF</button>
</div>
</div>

<!-- Customer Form -->
<div id="customerForm" class="hidden modal-bg w-full max-w-md p-8 rounded-t-[40px] modal-up border-t">
<h2 id="customerFormTitle" class="text-xl font-black mb-6 text-indigo-500 uppercase">Customer</h2>
<input type="hidden" id="editCustId">
<div class="space-y-4">
<input type="text" id="custName" class="w-full bg-black/10 p-5 rounded-2xl border border-slate-700 font-bold text-main" placeholder="പേര് (Name)">
<input type="number" id="custPhone" class="w-full bg-black/10 p-5 rounded-2xl border border-slate-700 font-bold text-main" placeholder="മൊബൈൽ (WhatsApp)">
</div>
<button onclick="saveCustomer()" class="w-full bg-indigo-600 text-white py-5 rounded-3xl font-black mt-8 shadow-xl">സേവ് ചെയ്യുക</button>
<button onclick="closeModal()" class="w-full py-4 text-sub font-bold">Cancel</button>
</div>

<!-- Transaction Form -->
<div id="transForm" class="hidden modal-bg w-full max-w-md p-8 rounded-t-[40px] modal-up border-t">
<div class="flex justify-between items-center mb-6">
<h2 id="transFormTitle" class="text-xl font-black text-indigo-500 uppercase tracking-tighter">Entry</h2>
<button id="deleteTransBtn" onclick="deleteTransaction()" class="text-rose-500 bg-rose-500/10 w-12 h-12 rounded-2xl"><i class="fa-solid fa-trash"></i></button>
</div>
<input type="hidden" id="editTransId"><input type="hidden" id="transType">
<div class="space-y-4">
<input type="date" id="transDate" class="w-full bg-black/10 p-4 rounded-2xl border border-slate-700 font-bold text-main">
<div class="bg-indigo-600/5 p-8 rounded-[35px] border border-indigo-500/20 text-center">
<p class="text-[10px] text-indigo-400 font-black uppercase mb-1">Amount</p>
<div class="flex items-center justify-center gap-2">
<span class="text-3xl font-black text-indigo-500">₹</span>
<input type="number" id="amount" placeholder="0" class="bg-transparent w-full text-5xl font-black text-main outline-none">
</div>
</div>
<input type="text" id="remark" placeholder="വിവരണം (Remark)" class="w-full bg-black/10 p-4 rounded-2xl border border-slate-700 font-bold text-main">
</div>
<button onclick="saveTransaction()" class="w-full bg-indigo-600 text-white py-5 rounded-[28px] font-black mt-8 shadow-2xl">സേവ് ചെയ്യുക</button>
<button onclick="closeModal()" class="w-full py-4 text-sub font-bold">മടങ്ങുക</button>
</div>

<!-- Settings -->
<div id="settingsForm" class="hidden modal-bg w-full max-w-md p-8 rounded-t-[40px] border-t">
<h2 class="text-2xl font-black mb-8 text-indigo-500 uppercase">Settings</h2>
<div class="space-y-4">
<button onclick="exportBackup()" class="w-full card p-5 rounded-3xl font-bold flex justify-between items-center text-main border">
<span class="flex items-center gap-3"><i class="fa-solid fa-download text-indigo-500"></i> Backup Data</span>
<i class="fa-solid fa-chevron-right text-sub"></i>
</button>
<button onclick="triggerImport()" class="w-full card p-5 rounded-3xl font-bold flex justify-between items-center text-main border">
<span class="flex items-center gap-3"><i class="fa-solid fa-upload text-emerald-500"></i> Restore Data</span>
<i class="fa-solid fa-chevron-right text-sub"></i>
</button>
<input type="file" id="importFile" class="hidden" onchange="importBackup(event)">
</div>
<button onclick="closeModal()" class="w-full py-8 text-sub font-bold uppercase">Close</button>
</div>
</div>

<script>
const { jsPDF } = window.jspdf;
let db = JSON.parse(localStorage.getItem('khata_pro_v35_max')) || { customers: [], trans: [], darkMode: true };
let activeCid = null;
const myUPI = "abdulsaleemkp563-3@okhdfcbank";

const sync = () => localStorage.setItem('khata_pro_v35_max', JSON.stringify(db));
const getBalance = (cid) => db.trans.filter(t => t.cid == cid).reduce((a, t) => t.type === 'GAVE' ? a + t.amt : a - t.amt, 0);

// --- Theme Logic ---
function toggleDarkMode() {
db.darkMode = !db.darkMode;
applyTheme();
sync();
}

function applyTheme() {
const body = document.body;
const icon = document.getElementById('themeIcon');
if(db.darkMode) {
body.classList.replace('light-mode', 'dark-mode');
icon.classList.replace('fa-sun', 'fa-moon');
} else {
body.classList.add('light-mode');
body.classList.remove('dark-mode');
icon.classList.replace('fa-moon', 'fa-sun');
}
}

// --- Core Rendering ---
function renderHome(filtered = null) {
const listData = filtered || db.customers;
let giveTotal = 0, getTotal = 0;

const list = listData.map(c => {
const bal = getBalance(c.id);
if (bal > 0) giveTotal += bal; else getTotal += Math.abs(bal);
return `
<div class="p-5 border-b border-slate-500/10 flex justify-between items-center active-scale" onclick="showDetail(${c.id})">
<div class="flex items-center gap-4">
<div class="w-14 h-14 bg-indigo-500/10 text-indigo-500 rounded-2xl flex items-center justify-center font-black text-xl border border-indigo-500/20">${c.name.charAt(0).toUpperCase()}</div>
<div>
<p class="font-black text-main text-lg leading-tight">${c.name}</p>
<p class="text-[10px] text-sub font-black mt-1 tracking-widest">${c.phone || 'NO PHONE'}</p>
</div>
</div>
<div class="text-right">
<p class="text-xl font-black ${bal >= 0 ? 'text-rose-500' : 'text-emerald-500'}">₹${Math.abs(bal)}</p>
<span class="text-[8px] font-black uppercase tracking-widest px-2 py-1 rounded-md ${bal >= 0 ? 'bg-rose-500/10 text-rose-500' : 'bg-emerald-500/10 text-emerald-500'}">
${bal >= 0 ? 'GIVE' : 'GET'}
</span>
</div>
</div>`;
}).join('');

document.getElementById('appContent').innerHTML = `
<div class="premium-header">
<div class="grid grid-cols-2 gap-4">
<div class="bg-white/10 p-5 rounded-3xl border border-white/5">
<p class="text-[9px] font-bold text-indigo-200 uppercase mb-1">നൽകാൻ (Give)</p>
<p class="text-2xl font-black text-white">₹${giveTotal}</p>
</div>
<div class="bg-white/10 p-5 rounded-3xl border border-white/5">
<p class="text-[9px] font-bold text-indigo-200 uppercase mb-1">ലഭിക്കാൻ (Get)</p>
<p class="text-2xl font-black text-white">₹${getTotal}</p>
</div>
</div>
</div>
<div class="mt-2 px-2">${list || '<div class="py-40 text-center text-sub font-black">No Customers</div>'}</div>
`;
}

function renderDetail(cid) {
const items = db.trans.filter(t => t.cid == cid).sort((a,b) => new Date(b.date) - new Date(a.date));
const c = db.customers.find(x => x.id == cid);
const bal = getBalance(cid);

let rows = items.map(t => `
<tr onclick="openEditTrans(${t.id})" class="active:bg-indigo-500/5">
<td class="text-sub font-bold text-[10px]">${t.date.split('-').reverse().join('/')}</td>
<td class="amt-get font-black">${t.type === 'GOT' ? '₹'+t.amt : '-'}</td>
<td class="amt-give font-black">${t.type === 'GAVE' ? '₹'+t.amt : '-'}</td>
</tr>`).join('');

document.getElementById('appContent').innerHTML = `
<div class="bg-gradient-to-b from-[#3730a3] to-[#2e1065] p-8 pb-14 rounded-b-[45px]">
<div class="flex justify-between items-start mb-6">
<div>
<h2 class="text-4xl font-black text-white tracking-tighter">${c.name}</h2>
<p class="text-indigo-300 font-black text-[10px] mt-2 tracking-widest uppercase">${c.phone || 'Business Account'}</p>
</div>
<div class="flex flex-col gap-3">
<button onclick="openReportModal(${cid})" class="bg-white/10 w-12 h-12 rounded-2xl flex items-center justify-center active-scale text-white"><i class="fa-solid fa-file-lines"></i></button>
<button onclick="openCustomerModal(${cid})" class="bg-white/10 w-12 h-12 rounded-2xl flex items-center justify-center active-scale text-white"><i class="fa-solid fa-user-pen"></i></button>
<button onclick="deleteCustomer(${cid})" class="bg-rose-500/20 w-12 h-12 rounded-2xl flex items-center justify-center active-scale text-rose-300"><i class="fa-solid fa-trash"></i></button>
</div>
</div>

<div class="bg-white/5 backdrop-blur-md rounded-[30px] p-6 border border-white/10">
<p class="text-[9px] text-indigo-300 font-black uppercase mb-2">Net Balance</p>
<div class="flex items-center gap-4">
<h3 class="text-5xl font-black text-white">₹${Math.abs(bal)}</h3>
<span class="px-3 py-1 rounded-md text-[8px] font-black uppercase ${bal >= 0 ? 'bg-rose-500/20 text-rose-300' : 'bg-emerald-500/20 text-emerald-300'}">
${bal >= 0 ? 'Payable' : 'Receivable'}
</span>
</div>
</div>
</div>

<div class="p-4 mt-2">
<div class="overflow-hidden rounded-[30px] border border-slate-500/10 card">
<table class="khata-table">
<thead><tr><th>DATE</th><th>GOT</th><th>GIVE</th></tr></thead>
<tbody>${rows || '<tr><td colspan="3" class="py-24 text-sub font-black">No History</td></tr>'}</tbody>
</table>
</div>
</div>
`;
}

// --- Report Preview & PDF ---
window.openReportModal = (cid) => {
activeCid = cid;
document.getElementById('reportStart').value = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
document.getElementById('reportEnd').value = new Date().toISOString().split('T')[0];
updatePreview();
showModal('reportModal');
};

window.updatePreview = () => {
const start = document.getElementById('reportStart').value;
const end = document.getElementById('reportEnd').value;
const c = db.customers.find(x => x.id == activeCid);
const items = db.trans.filter(t => t.cid == activeCid && t.date >= start && t.date <= end).sort((a,b) => new Date(a.date) - new Date(b.date));

if(items.length === 0) {
document.getElementById('reportPreviewContent').innerHTML = `<p class="text-center text-sub py-10 font-bold">ഈ കാലയളവിൽ ഇടപാടുകൾ ഒന്നുമില്ല</p>`;
return;
}

let tableHtml = `
<div class="text-center mb-4">
<h4 class="font-black text-indigo-500">${c.name}</h4>
<p class="text-[10px] text-sub">${start} - ${end}</p>
</div>
<table>
<thead><tr><th>Date</th><th>Got</th><th>Gave</th></tr></thead>
<tbody>
${items.map(t => `<tr><td>${t.date}</td><td>${t.type === 'GOT' ? '₹'+t.amt : '-'}</td><td>${t.type === 'GAVE' ? '₹'+t.amt : '-'}</td></tr>`).join('')}
</tbody>
</table>
`;
document.getElementById('reportPreviewContent').innerHTML = tableHtml;
};

window.downloadPDF = () => {
const start = document.getElementById('reportStart').value;
const end = document.getElementById('reportEnd').value;
const c = db.customers.find(x => x.id == activeCid);
const items = db.trans.filter(t => t.cid == activeCid && t.date >= start && t.date <= end).sort((a,b) => new Date(a.date) - new Date(b.date));

const doc = new jsPDF();
doc.setFontSize(20); doc.setTextColor(79, 70, 229); doc.text("KHATA STATEMENT", 14, 20);
doc.setFontSize(10); doc.setTextColor(100);
doc.text(`Customer: ${c.name}`, 14, 30);
doc.text(`Period: ${start} to ${end}`, 14, 35);

const tableData = items.map(t => [t.date, t.type === 'GOT' ? t.amt : '-', t.type === 'GAVE' ? t.amt : '-', t.desc]);
doc.autoTable({ startY: 45, head: [['Date', 'Received (Got)', 'Paid (Gave)', 'Remark']], body: tableData, headStyles: { fillColor: [79, 70, 229] } });

doc.save(`${c.name}_Report.pdf`);
};

// --- Core Functions ---
window.saveCustomer = () => {
const name = document.getElementById('custName').value.trim();
const phone = document.getElementById('custPhone').value.trim();
const editId = document.getElementById('editCustId').value;
if (!name) return;
if(editId) {
const idx = db.customers.findIndex(x => x.id == editId);
db.customers[idx] = { ...db.customers[idx], name, phone };
} else {
db.customers.push({ id: Date.now(), name, phone });
}
sync(); closeModal(); activeCid ? showDetail(activeCid) : goHome();
};

window.saveTransaction = () => {
const amt = Number(document.getElementById('amount').value);
const date = document.getElementById('transDate').value;
const editId = document.getElementById('editTransId').value;
if (!amt || !date) return;
if (editId) {
const idx = db.trans.findIndex(x => x.id == editId);
db.trans[idx] = { ...db.trans[idx], amt, date, desc: document.getElementById('remark').value || 'Entry' };
} else {
db.trans.push({ id: Date.now(), cid: activeCid, amt, type: document.getElementById('transType').value, date, desc: document.getElementById('remark').value || 'Entry' });
}
sync(); closeModal(); renderDetail(activeCid);
};

// --- UI Helpers ---
function showModal(id) { document.getElementById('modalOverlay').classList.remove('hidden'); document.querySelectorAll('#modalOverlay > div').forEach(d => d.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
window.closeModal = () => document.getElementById('modalOverlay').classList.add('hidden');
window.goHome = () => { activeCid = null; document.getElementById('headerTitle').innerText = 'KHATA MAX'; document.getElementById('backBtn').classList.add('hidden'); document.getElementById('homeFooter').classList.remove('hidden'); document.getElementById('detailActions').classList.add('hidden'); renderHome(); };
window.showDetail = (id) => { activeCid = id; const c = db.customers.find(x => x.id == id); document.getElementById('headerTitle').innerText = 'ACCOUNT'; document.getElementById('backBtn').classList.remove('hidden'); document.getElementById('homeFooter').classList.add('hidden'); document.getElementById('detailActions').classList.remove('hidden'); renderDetail(id); };
window.toggleSearch = () => { const el = document.getElementById('searchContainer'); el.classList.toggle('hidden'); if(!el.classList.contains('hidden')) document.getElementById('searchInput').focus(); else { document.getElementById('searchInput').value = ''; renderHome(); } };
window.filterList = () => { const q = document.getElementById('searchInput').value.toLowerCase(); renderHome(db.customers.filter(c => c.name.toLowerCase().includes(q))); };
window.openSettings = () => showModal('settingsForm');
window.exportBackup = () => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(db)])); a.download = `Khata_Max_Backup.json`; a.click(); };
window.triggerImport = () => document.getElementById('importFile').click();
window.importBackup = (e) => { const r = new FileReader(); r.onload = (ev) => { db = JSON.parse(ev.target.result); sync(); location.reload(); }; r.readAsText(e.target.files[0]); };

window.openCustomerModal = (cid = null) => {
const isEdit = !!cid;
document.getElementById('customerFormTitle').innerText = isEdit ? "Edit Account" : "New Account";
document.getElementById('editCustId').value = isEdit ? cid : "";
document.getElementById('custName').value = isEdit ? db.customers.find(x => x.id == cid).name : "";
document.getElementById('custPhone').value = isEdit ? (db.customers.find(x => x.id == cid).phone || "") : "";
showModal('customerForm');
};

window.openTransModal = (type) => {
document.getElementById('transType').value = type;
document.getElementById('editTransId').value = "";
document.getElementById('amount').value = "";
document.getElementById('remark').value = "";
document.getElementById('transDate').value = new Date().toISOString().split('T')[0];
document.getElementById('deleteTransBtn').classList.add('hidden');
document.getElementById('transFormTitle').innerText = type === 'GAVE' ? "GIVE (നൽകി)" : "GET (ലഭിച്ചു)";
showModal('transForm');
};

window.openEditTrans = (tid) => {
const t = db.trans.find(x => x.id == tid);
document.getElementById('editTransId').value = t.id;
document.getElementById('amount').value = t.amt;
document.getElementById('remark').value = t.desc;
document.getElementById('transDate').value = t.date;
document.getElementById('deleteTransBtn').classList.remove('hidden');
document.getElementById('transFormTitle').innerText = "Edit Entry";
showModal('transForm');
};

window.deleteTransaction = () => { if(confirm("Delete entry?")) { db.trans = db.trans.filter(t => t.id != document.getElementById('editTransId').value); sync(); closeModal(); renderDetail(activeCid); } };
window.deleteCustomer = (id) => { if(confirm("Account പൂർണ്ണമായും ഒഴിവാക്കട്ടെ?")) { db.customers = db.customers.filter(c => c.id != id); db.trans = db.trans.filter(t => t.cid != id); sync(); goHome(); } };

window.onload = () => {
document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
applyTheme();
renderHome();
};
</script>
</body>
</html>