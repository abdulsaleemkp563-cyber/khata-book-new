<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KHATA PRO - PREMIUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #1e293b; transition: 0.3s; }
        .premium-card { background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%); border-radius: 0 0 40px 40px; }
        .glass-input { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .cust-item { background: white; border-radius: 24px; transition: 0.2s; border: 1px solid #f1f5f9; }
        .cust-item:active { transform: scale(0.97); background: #f1f5f9; }
        .fab-main { position: fixed; bottom: 100px; right: 20px; width: 60px; height: 60px; background: #2563eb; color: white; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3); z-index: 50; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 480px; background: white; padding: 20px; display: flex; gap: 12px; border-top: 1px solid #f1f5f9; z-index: 100; }
        .btn-gave { background: #ef4444; color: white; flex: 1; padding: 16px; border-radius: 18px; font-weight: 800; }
        .btn-got { background: #22c55e; color: white; flex: 1; padding: 16px; border-radius: 18px; font-weight: 800; }
        .hidden { display: none; }
    </style>
</head>
<body class="max-w-[480px] mx-auto pb-32">

    <div id="homePage">
        <div class="premium-card p-8 pb-16 text-white relative">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-xl font-extrabold tracking-tight">KHATA PRO</h1>
                <div class="flex gap-4 opacity-80">
                    <i class="fa-solid fa-moon text-lg"></i>
                    <i class="fa-solid fa-cloud-arrow-down text-lg" onclick="exportData()"></i>
                </div>
            </div>
            <div class="text-center">
                <p class="text-xs font-bold opacity-70 uppercase tracking-widest">Global Net Balance</p>
                <h2 id="totalBal" class="text-5xl font-extrabold mt-2">₹0</h2>
                <div class="flex justify-around mt-8 bg-white/10 p-4 rounded-2xl backdrop-blur-md">
                    <div><p class="text-[10px] opacity-70 uppercase">Give</p><b id="totalGive" class="text-lg">₹0</b></div>
                    <div class="w-[1px] bg-white/20"></div>
                    <div><p class="text-[10px] opacity-70 uppercase">Get</p><b id="totalGet" class="text-lg">₹0</b></div>
                </div>
            </div>
        </div>

        <div class="px-5 -mt-8">
            <input type="text" id="search" oninput="renderHome()" class="glass-input w-full p-5 outline-none text-slate-600" placeholder="Search customer...">
        </div>

        <div class="p-5">
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Directory</p>
            <div id="customerList" class="space-y-3"></div>
        </div>
    </div>

    <div id="detailsPage" class="hidden">
        <div class="p-6 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <button onclick="showHome()" class="w-10 h-10 bg-white shadow-sm rounded-full flex items-center justify-center"><i class="fa-solid fa-arrow-left"></i></button>
                <h2 id="detName" class="text-xl font-extrabold">Name</h2>
            </div>
            <div class="flex gap-4 opacity-50"><i class="fa-solid fa-moon"></i><i class="fa-solid fa-cloud-arrow-down"></i></div>
        </div>
        
        <div class="premium-card mx-5 p-10 text-center text-white">
            <h2 id="detBal" class="text-5xl font-extrabold">₹0</h2>
            <div class="flex gap-3 justify-center mt-6">
                <button class="bg-white/20 px-6 py-2 rounded-xl text-xs font-bold uppercase">Report</button>
                <button class="bg-white/20 px-6 py-2 rounded-xl text-xs font-bold uppercase">QR Pay</button>
            </div>
        </div>

        <div id="transList" class="p-5 space-y-3"></div>
    </div>

    <div id="mainActions" class="bottom-nav">
        <button onclick="openTrans('GAVE')" class="btn-gave">GAVE ₹</button>
        <button onclick="openTrans('GOT')" class="btn-got">GOT ₹</button>
    </div>

    <div id="addBtn" class="fab-main" onclick="openCustModal()"><i class="fa-solid fa-user-plus"></i></div>

    <script>
        const DB_KEY = 'KHATA_PREMIUM_V27';
        let db = JSON.parse(localStorage.getItem(DB_KEY)) || { customers: [], trans: [] };
        let activeCid = null;

        function sync() {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            renderHome();
            if(activeCid) renderDetails();
        }

        function renderHome() {
            const list = document.getElementById('customerList');
            const search = document.getElementById('search').value.toLowerCase();
            list.innerHTML = '';
            let tGive = 0, tGet = 0;

            db.customers.filter(c => c.name.toLowerCase().includes(search)).forEach(c => {
                let bal = 0;
                db.trans.filter(t => t.cid === c.id).forEach(t => bal += (t.type === 'GAVE' ? t.amt : -t.amt));
                if(bal > 0) tGive += bal; else tGet += Math.abs(bal);

                list.innerHTML += `
                    <div class="cust-item p-4 flex items-center justify-between shadow-sm" onclick="showDetails(${c.id})">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-rose-100 text-rose-600 rounded-2xl flex items-center justify-center font-black text-xl">${c.name[0]}</div>
                            <div><b class="text-lg block">${c.name}</b><span class="text-[10px] opacity-40">${c.phone || 'No Contact'}</span></div>
                        </div>
                        <div class="text-right">
                            <b class="text-lg block ${bal >= 0 ? 'text-rose-500' : 'text-emerald-500'}">₹${Math.abs(bal)}</b>
                            <span class="text-[10px] opacity-30 uppercase font-bold">${bal >= 0 ? 'Give' : 'Get'}</span>
                        </div>
                    </div>`;
            });
            document.getElementById('totalBal').innerText = '₹' + (tGive - tGet);
            document.getElementById('totalGive').innerText = '₹' + tGive;
            document.getElementById('totalGet').innerText = '₹' + tGet;
        }

        function showDetails(id) {
            activeCid = id;
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('addBtn').classList.add('hidden');
            document.getElementById('detailsPage').classList.remove('hidden');
            renderDetails();
        }

        function showHome() {
            activeCid = null;
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('addBtn').classList.remove('hidden');
            document.getElementById('detailsPage').classList.add('hidden');
            renderHome();
        }

        function openCustModal() {
            const name = prompt("Enter Customer Name:");
            if(!name) return;
            const phone = prompt("Enter Phone (Optional):");
            db.customers.push({ id: Date.now(), name, phone });
            sync();
        }

        function openTrans(type) {
            if(!activeCid) return alert("Select a customer first!");
            const amt = parseFloat(prompt(`Enter ${type} Amount:`));
            if(!amt) return;
            db.trans.push({ id: Date.now(), cid: activeCid, type, amt, date: new Date() });
            sync();
        }

        function renderDetails() {
            const cust = db.customers.find(c => c.id === activeCid);
            document.getElementById('detName').innerText = cust.name;
            const list = document.getElementById('transList');
            list.innerHTML = '';
            let bal = 0;

            db.trans.filter(t => t.cid === activeCid).forEach(t => {
                bal += (t.type === 'GAVE' ? t.amt : -t.amt);
                list.innerHTML = `
                    <div class="bg-white p-5 rounded-3xl shadow-sm flex justify-between items-center border border-slate-50">
                        <div><p class="text-xs opacity-40 mb-1">${new Date(t.date).toLocaleDateString()}</p><b>${t.type}</b></div>
                        <div class="flex gap-8">
                            <div class="text-center"><p class="text-rose-500 font-bold">${t.type==='GAVE' ? t.amt : '-'}</p></div>
                            <div class="text-center"><p class="text-emerald-500 font-bold">${t.type==='GOT' ? t.amt : '-'}</p></div>
                        </div>
                        <b class="text-slate-400">₹${Math.abs(bal)}</b>
                    </div>` + list.innerHTML;
            });
            document.getElementById('detBal').innerText = '₹' + Math.abs(bal);
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
            const dl = document.createElement('a');
            dl.setAttribute("href", dataStr); dl.setAttribute("download", "khata_pro_backup.json");
            dl.click();
        }

        window.onload = renderHome;
    </script>
</body>
</html>