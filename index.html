<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KHATA PRO - ORIGINAL FULL VERSION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #0f172a; color: white; margin: 0; }
        .app { max-width: 480px; margin: auto; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Header & Dashboard */
        .dashboard-card { 
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); 
            padding: 35px 20px; border-radius: 0 0 35px 35px; text-align: center; 
            box-shadow: 0 10px 25px rgba(30, 64, 175, 0.3); 
        }
        .balance-amount { font-size: 42px; font-weight: 800; color: white; margin: 10px 0; }

        /* Lists */
        .cust-card { 
            background: #1e293b; padding: 16px; border-radius: 20px; 
            margin: 10px 15px; display: flex; align-items: center; 
            border: 1px solid rgba(255,255,255,0.05); cursor: pointer;
        }
        .cust-card:active { transform: scale(0.98); }
        .avatar { width: 45px; height: 45px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-weight: 800; color: white; margin-right: 15px; background: #2563eb; }

        .trans-card { 
            background: #1e293b; padding: 15px; border-radius: 18px; 
            margin-bottom: 10px; display: grid; grid-template-columns: 1fr 1fr 1fr auto; 
            align-items: center; font-size: 13px;
        }

        /* Modals */
        .modal-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); 
            display: none; align-items: flex-end; z-index: 2000; 
            backdrop-filter: blur(5px); 
        }
        .modal-content { 
            background: #1e293b; width: 100%; padding: 25px; 
            border-radius: 30px 30px 0 0; transform: translateY(100%); 
            transition: 0.3s ease; 
        }
        .modal-overlay.active { display: flex; }
        .modal-overlay.active .modal-content { transform: translateY(0); }

        .input-field { 
            width: 100%; padding: 15px; border-radius: 15px; border: 1px solid #334155; 
            background: #0f172a; color: white; outline: none; margin-bottom: 15px;
        }

        /* Controls */
        .fab { 
            position: fixed; bottom: 30px; right: 20px; width: 65px; height: 65px; 
            background: #2563eb; color: white; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-size: 24px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); z-index: 100; border: none;
        }
        .footer-btns { 
            position: fixed; bottom: 0; width: 100%; max-width: 480px; 
            padding: 15px; display: flex; gap: 10px; background: #0f172a; 
        }
    </style>
</head>
<body>

    <div class="app">
        <div id="homePage">
            <div class="p-5 flex justify-between items-center">
                <h1 class="text-xl font-black tracking-tighter text-blue-500">KHATA PRO</h1>
                <div class="flex gap-4">
                    <button onclick="backupData()"><i class="fa-solid fa-cloud-arrow-down"></i></button>
                    <button onclick="resetAll()" class="text-red-500 text-xs">RESET</button>
                </div>
            </div>

            <div class="dashboard-card">
                <p class="text-white/60 text-xs font-bold uppercase tracking-widest">Total Balance</p>
                <h2 id="mainBal" class="balance-amount">₹0</h2>
            </div>

            <div id="customerList" class="py-5 pb-32"></div>
            <button class="fab" onclick="openModal('custModal')"><i class="fa-solid fa-plus"></i></button>
        </div>

        <div id="detailsPage" class="hidden">
            <div class="p-5 flex items-center gap-4">
                <button onclick="showHome()"><i class="fa-solid fa-arrow-left text-xl"></i></button>
                <h2 id="detName" class="text-lg font-bold">Customer Name</h2>
            </div>
            
            <div class="dashboard-card mx-4 rounded-3xl py-8">
                <h2 id="detBal" class="text-3xl font-black">₹0</h2>
                <button onclick="sendWA()" class="mt-3 text-xs bg-white/20 px-4 py-2 rounded-full"><i class="fa-brands fa-whatsapp mr-2"></i>Remind</button>
            </div>

            <div id="transList" class="p-5 pb-32"></div>

            <div class="footer-btns">
                <button onclick="openTrans('GAVE')" class="flex-1 p-4 bg-red-600 rounded-2xl font-black">GAVE ₹</button>
                <button onclick="openTrans('GOT')" class="flex-1 p-4 bg-green-600 rounded-2xl font-black">GOT ₹</button>
            </div>
        </div>
    </div>

    <div id="custModal" class="modal-overlay" onclick="closeModal('custModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 class="font-bold mb-4 text-center">ADD NEW CUSTOMER</h3>
            <input type="text" id="c_name" class="input-field" placeholder="Name">
            <input type="number" id="c_phone" class="input-field" placeholder="WhatsApp Number">
            <button onclick="saveCust()" class="w-full p-4 bg-blue-600 rounded-xl font-bold">SAVE CUSTOMER</button>
        </div>
    </div>

    <div id="transModal" class="modal-overlay" onclick="closeModal('transModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 id="t_title" class="font-bold mb-4 text-center">ADD ENTRY</h3>
            <input type="number" id="t_amt" class="input-field text-center text-2xl font-bold" placeholder="0.00">
            <input type="text" id="t_note" class="input-field" placeholder="Remark">
            <button onclick="saveEntry()" class="w-full p-4 bg-blue-600 rounded-xl font-bold">SAVE ENTRY</button>
        </div>
    </div>

    <script>
        const DB_KEY = 'KHATA_ULTIMATE_V26';
        let db = JSON.parse(localStorage.getItem(DB_KEY)) || { customers: [], trans: [] };
        let activeCid = null;
        let entryType = 'GAVE';

        function sync() {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            renderHome();
            if(activeCid) renderDetails();
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function saveCust() {
            const name = document.getElementById('c_name').value.trim();
            const phone = document.getElementById('c_phone').value.trim();
            if(!name) return alert("Enter Name");
            
            db.customers.push({ id: Date.now(), name, phone });
            document.getElementById('c_name').value = '';
            document.getElementById('c_phone').value = '';
            closeModal('custModal');
            sync();
        }

        function renderHome() {
            const list = document.getElementById('customerList');
            list.innerHTML = '';
            let total = 0;

            db.customers.forEach(c => {
                let bal = 0;
                db.trans.filter(t => t.cid === c.id).forEach(t => bal += (t.type === 'GAVE' ? t.amt : -t.amt));
                total += bal;

                list.innerHTML += `
                    <div class="cust-card" onclick="showDetails(${c.id})">
                        <div class="avatar">${c.name[0].toUpperCase()}</div>
                        <div class="flex-1">
                            <b class="text-lg">${c.name}</b><br>
                            <span class="text-xs opacity-40">${c.phone || ''}</span>
                        </div>
                        <div class="text-right">
                            <b class="${bal >= 0 ? 'text-red-500' : 'text-green-500'}">₹${Math.abs(bal)}</b>
                        </div>
                    </div>`;
            });
            document.getElementById('mainBal').innerText = '₹' + total;
        }

        function showDetails(id) {
            activeCid = id;
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('detailsPage').classList.remove('hidden');
            renderDetails();
        }

        function showHome() {
            activeCid = null;
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('detailsPage').classList.add('hidden');
            renderHome();
        }

        function openTrans(type) {
            entryType = type;
            document.getElementById('t_title').innerText = type + " ENTRY";
            openModal('transModal');
        }

        function saveEntry() {
            const amt = parseFloat(document.getElementById('t_amt').value);
            const note = document.getElementById('t_note').value;
            if(!amt) return;

            db.trans.push({ id: Date.now(), cid: activeCid, type: entryType, amt, note, date: new Date() });
            document.getElementById('t_amt').value = '';
            document.getElementById('t_note').value = '';
            closeModal('transModal');
            sync();
        }

        function renderDetails() {
            const cust = db.customers.find(c => c.id === activeCid);
            document.getElementById('detName').innerText = cust.name;
            const list = document.getElementById('transList');
            list.innerHTML = '';
            let bal = 0;

            db.trans.filter(t => t.cid === activeCid).forEach(t => {
                bal += (t.type === 'GAVE' ? t.amt : -t.amt);
                list.innerHTML = `
                    <div class="trans-card">
                        <div><p class="font-bold">${t.note || t.type}</p><p class="text-[9px] opacity-30">${new Date(t.date).toLocaleDateString()}</p></div>
                        <div class="text-red-500 font-bold text-center">${t.type==='GAVE' ? '₹'+t.amt : '-'}</div>
                        <div class="text-green-500 font-bold text-center">${t.type==='GOT' ? '₹'+t.amt : '-'}</div>
                        <div class="text-right opacity-30">₹${Math.abs(bal)}</div>
                    </div>` + list.innerHTML;
            });
            document.getElementById('detBal').innerText = '₹' + Math.abs(bal);
        }

        function sendWA() {
            const cust = db.customers.find(c => c.id === activeCid);
            if(!cust.phone) return alert("No phone number!");
            const bal = document.getElementById('detBal').innerText;
            const msg = `Hi ${cust.name}, Your pending balance in KHATA PRO is ${bal}. Please settle it soon.`;
            window.open(`https://wa.me/${cust.phone}?text=${encodeURIComponent(msg)}`);
        }

        function resetAll() { if(confirm("Clear all data?")) { localStorage.clear(); location.reload(); } }
        
        function backupData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
            const dlAnchorElem = document.createElement('a');
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", "khata_backup.json");
            dlAnchorElem.click();
        }

        window.onload = renderHome;
    </script>
</body>
</html>