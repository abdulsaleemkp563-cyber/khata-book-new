<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KHATA PRO - V19 MOBILE FIXED</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #0f172a; color: #f8fafc; overflow-x: hidden; }
        .app { max-width: 480px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; }
        .dashboard { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); padding: 35px 20px; border-radius: 0 0 35px 35px; text-align: center; }
        .card { background: #1e293b; padding: 18px; border-radius: 20px; margin: 12px 20px; display: flex; align-items: center; border: 1px solid rgba(255,255,255,0.05); }
        .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; z-index: 9999; align-items: center; justify-content: center; padding: 20px; }
        .modal-box { background: #1e293b; width: 100%; max-width: 400px; padding: 30px; border-radius: 30px; }
        .input { width: 100%; padding: 16px; border-radius: 12px; border: 2px solid #334155; background: #0f172a; color: white; margin-bottom: 15px; font-size: 16px; outline: none; }
        .btn-blue { width: 100%; padding: 16px; background: #2563eb; color: white; border-radius: 12px; font-weight: 800; border: none; font-size: 16px; cursor: pointer; }
        .fab { position: fixed; bottom: 30px; right: 20px; width: 65px; height: 65px; background: #2563eb; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 10px 20px rgba(0,0,0,0.4); border: none; }
    </style>
</head>
<body>

    <div class="app">
        <div class="dashboard">
            <h1 class="text-xl font-black italic">KHATA PRO</h1>
            <p class="text-xs opacity-60 mt-2 uppercase tracking-widest">Total Net Balance</p>
            <h2 id="totalBalance" class="text-4xl font-black mt-1">₹0</h2>
        </div>

        <div id="customerList" class="mt-4 pb-24">
            </div>

        <button class="fab" onclick="showAddModal()"><i class="fa-solid fa-plus"></i></button>
    </div>

    <div id="addModal" class="modal-bg">
        <div class="modal-box">
            <h3 class="text-center font-bold mb-6">ADD NEW CUSTOMER</h3>
            <input type="text" id="custName" class="input" placeholder="Customer Name" autocomplete="off">
            <input type="number" id="custPhone" class="input" placeholder="WhatsApp Number (91...)">
            <button class="btn-blue" onclick="saveCustomer()">SAVE TO BOOK</button>
            <button class="w-full mt-4 text-sm opacity-40" onclick="hideAddModal()">CANCEL</button>
        </div>
    </div>

    <script>
        // കൂടുതൽ വ്യക്തമായ ഡാറ്റാബേസ് പേര്
        const DB_NAME = 'KHATA_PRO_STORAGE_V19';
        let db = JSON.parse(localStorage.getItem(DB_NAME)) || { customers: [] };

        function refreshUI() {
            localStorage.setItem(DB_NAME, JSON.stringify(db));
            const list = document.getElementById('customerList');
            const totalDisplay = document.getElementById('totalBalance');
            list.innerHTML = '';
            
            if (db.customers.length === 0) {
                list.innerHTML = '<p class="text-center opacity-20 mt-10">No customers added yet</p>';
            }

            db.customers.forEach((c) => {
                list.innerHTML += `
                    <div class="card">
                        <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center font-bold text-xl mr-4">${c.name[0].toUpperCase()}</div>
                        <div class="flex-1">
                            <b class="text-lg">${c.name}</b><br>
                            <span class="text-xs opacity-40">${c.phone || ''}</span>
                        </div>
                        <button onclick="deleteCustomer(${c.id})" class="p-2 opacity-20"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
            });
        }

        function showAddModal() { document.getElementById('addModal').style.display = 'flex'; }
        function hideAddModal() { 
            document.getElementById('addModal').style.display = 'none';
            document.getElementById('custName').value = '';
            document.getElementById('custPhone').value = '';
        }

        function saveCustomer() {
            const name = document.getElementById('custName').value.trim();
            const phone = document.getElementById('custPhone').value.trim();

            if (!name) {
                alert("Please enter customer name!");
                return;
            }

            const newObj = {
                id: Date.now(),
                name: name,
                phone: phone
            };

            db.customers.push(newObj);
            
            // ലോക്കൽ സ്റ്റോറേജിലേക്ക് ഉടൻ സേവ് ചെയ്യുന്നു
            localStorage.setItem(DB_NAME, JSON.stringify(db));
            
            // UI അപ്‌ഡേറ്റ് ചെയ്യുന്നു
            refreshUI();
            
            // മോഡൽ ഹൈഡ് ചെയ്യുന്നു
            hideAddModal();
            
            // മൊബൈലിൽ ഉറപ്പാക്കാൻ ഒരു ചെറിയ അലേർട്ട്
            console.log("Customer Saved: " + name);
        }

        function deleteCustomer(id) {
            if (confirm("Delete this customer?")) {
                db.customers = db.customers.filter(c => c.id !== id);
                refreshUI();
            }
        }

        // തുടക്കത്തിൽ ഡാറ്റ ലോഡ് ചെയ്യാൻ
        window.onload = refreshUI;
    </script>
</body>
</html>